<html>
<head>
    <meta charset="utf-8">
    <title>Ubuntu下使用VPN（基于PPTP协议）</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/blog.css">
</head>
<body>

<div class="container">
    <div class="blog-header">
        <h3 class="blog-title">学到老，活到老</h3>
        <hr/>
    </div>

    <div class="row col-sm-12 blog-main">
        <div class="blog-post">
            <h3 class="blog-post-title">
                Ubuntu下使用VPN（基于PPTP协议）
            </h3>
            <ol>
<li>
<p>首先要安装pptp-linux</p>
<pre><code>sudo apt-get install pptp-linux
</code></pre>
</li>
<li>
<p>初始化一个VPN的连接通道</p>
<pre><code>sudo pptpsetup --create myvpn --server xxx.xxx.xxx.xxx --username xx1 --password xx2 --encrypt --start
</code></pre>
<p>通过刚才的创建步骤，在/etc/ppp/peers目录下面，会生成一个叫myvpn的文件。在/etc/ppp目录下面，用户名和密码会写在chap-secrets文件中。这时候，虽然已经添加了VPN、并且启动了连接，但是默认的路由仍然是原来的，我们需要修改路由配置。</p>
</li>
<li>
<p>修改默认路由</p>
<pre><code>sudo ip route del default
sudo ip route add default dev ppp0
</code></pre>
<p>这时候已经可以通过VPN连接互联网了。</p>
</li>
<li>
<p>开启与关闭VPN时需要做的动作。在关闭VPN连接时，需要恢复原来的默认路由</p>
<pre><code>sudo poff myvpn
sudo ip route add default via xx.xx.xx.xx
</code></pre>
<p>开启VPN时，需要添加新的VPN为默认路由</p>
<pre><code>sudo pon myvpn
sudo ip route del default
sudo ip route add default dev ppp0
</code></pre>
</li>
<li>
<p>如果嫌每次输入命令麻烦，可以将这两段命令写在脚本文件中自动执行。</p>
<p>Ubuntu在开启VPN连接时，会自动执行/etc/ppp/ip-up.d/下的可执行文件，在关闭VPN连接时，会自动执行/etc/ppp/ip-down.d/目录下的可执行文件。</p>
<p>所以，可以把如下内容</p>
<pre><code>#!/bin/bash
/sbin/ip route del default
/sbin/ip route add default dev ppp0
</code></pre>
<p>写入 /etc/ppp/ip-up.d/route-traffic 文件。把如下内容</p>
<pre><code>#!/bin/bash
/sbin/ip route add default via 192.168.1.1
</code></pre>
<p>写入 /etc/ppp/ip-down.d/disableroute 文件。最后修改文件的执行权限</p>
<pre><code>sudo chmod a+x /etc/ppp/ip-up.d/route-traffic
sudo chmod a+x /etc/ppp/ip-down.d/disableroute
</code></pre>
<p>以后，要开启和关闭VPN，只需执行如下命令即可。</p>
<pre><code>sudo pon myvpn  
sudo poff myvpn
</code></pre>
</li>
</ol>
        </div>
    </div>

</div>
</body>
</html>