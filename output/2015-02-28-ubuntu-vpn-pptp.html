<html>
<head>
    <meta charset="utf-8">
    <title>Ubuntu下使用VPN（基于PPTP协议）</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/blog.css">
</head>
<body>

<div class="container">
    <div class="blog-header">
        <h3 class="blog-title">学到老，活到老</h3>
        <hr/>
    </div>

    <div class="row col-sm-12 blog-main">
        <div class="blog-post">
            <h3 class="blog-post-title">
                Ubuntu下使用VPN（基于PPTP协议）
            </h3>
            <p>三个主要的查看网络地址及路由的命令</p>
<p>```
ifconfig</p>
<p>route -n</p>
<p>ip route
```</p>
<ol>
<li>首先要安装pptp-linux</li>
</ol>
<p><code>sudo apt-get install pptp-linux</code></p>
<ol>
<li>初始化一个VPN的连接通道</li>
</ol>
<p><code>sudo pptpsetup --create myvpn --server xxx.xxx.xxx.xxx --username xx1 --password xx2 --encrypt --start</code></p>
<p>将输出</p>
<p>```
Using interface ppp0</p>
<p>Connect: ppp0 &lt;--&gt; /dev/pts/4</p>
<p>CHAP authentication succeeded</p>
<p>MPPE 128-bit stateless compression enabled</p>
<p>local  IP address 10.10.0.20</p>
<p>remote IP address 10.10.0.1
```</p>
<p>通过刚才的创建步骤，在/etc/ppp/peers目录下面，会生成一个叫myvpn的文件。在/etc/ppp目录下面，用户名和密码会写在chap-secrets文件中。</p>
<p>这时候，虽然已经添加了VPN、并且启动了连接，但是默认的路由仍然是原来的，我们需要修改路由配置。</p>
<ol>
<li>修改默认路由</li>
</ol>
<p>```
sudo ip route del default </p>
<p>sudo ip route add default dev ppp0
```</p>
<p>这时候已经可以通过VPN连接互联网了。</p>
<ol>
<li>开启与关闭VPN时需要做的动作</li>
</ol>
<p>在关闭VPN连接时，需要恢复原来的默认路由</p>
<p>```
sudo poff myvpn</p>
<p>sudo ip route add default via xx.xx.xx.xx
```</p>
<p>开启VPN时，需要添加新的VPN为默认路由</p>
<p>```
sudo pon myvpn</p>
<p>sudo ip route del default </p>
<p>sudo ip route add default dev ppp0
```</p>
<ol>
<li>如果嫌每次输入命令麻烦，可以将这两段命令写在脚本文件中自动执行。</li>
</ol>
<p>Ubuntu在开启VPN连接时，会自动执行/etc/ppp/ip-up.d/下的可执行文件，在关闭VPN连接时，会自动执行/etc/ppp/ip-down.d/目录下的可执行文件。</p>
<p>所以，可以把如下内容</p>
<p>```</p>
<h1>!/bin/bash</h1>
<p>/sbin/ip route del default</p>
<p>/sbin/ip route add default dev ppp0
```</p>
<p>写入</p>
<p><code>/etc/ppp/ip-up.d/route-traffic</code>
文件。</p>
<p>把如下内容</p>
<p>```</p>
<h1>!/bin/bash</h1>
<p>/sbin/ip route add default via 192.168.1.1
```</p>
<p>写入</p>
<p><code>/etc/ppp/ip-down.d/disableroute</code>
文件。</p>
<p>最后，修改文件的执行权限</p>
<p>```
sudo chmod a+x /etc/ppp/ip-up.d/route-traffic </p>
<p>sudo chmod a+x /etc/ppp/ip-down.d/disableroute 
```</p>
<p>以后，要开启和关闭VPN，只需执行</p>
<p><code>sudo pon myvpn</code></p>
<p><code>sudo poff myvpn</code></p>
<p>即可。</p>
        </div>
    </div>

</div>
</body>
</html>