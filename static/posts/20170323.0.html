<html>

<head>
    <meta charset="utf-8">
    <title>Django 中的 django-admin 与 manage.py - Lv Xiaoyu `Site</title>
    <link rel="stylesheet" href="../../static/css/bootstrap.min.css?v=1" />
    <link rel="stylesheet" href="../../static/css/mp.css?v=1" />
    <link rel="stylesheet" href="../../static/css/codehilite.css?v=1" />
</head>

<body>
    <div class="container">
        <div class="blog-header">
            <a href="../../index.html">
                <h1>Lv Xiaoyu `Site</h1>
            </a>
        </div>

        <div class="col-sm-9">
            <h3 class="blog-post-title">Django 中的 django-admin 与 manage.py</h3>

            <div class="post-content">
                <p>使用 Django 创建一个项目的命令我们都很熟悉，如下：</p>
<div class="codehilite"><pre><span></span>django-admin startproject ProjectName
</pre></div>


<p>这个命令会创建项目的目录、manage.py 文件、以及一个与项目同名的 Python package，
内含项目所需的各种配置项，一共生成了如下的目录结构：</p>
<div class="codehilite"><pre><span></span>.
└── ProjectName
    ├── ProjectName
    │   ├── __init__.py
    │   ├── settings.py
    │   ├── urls.py
    │   └── wsgi.py
    └── manage.py
</pre></div>


<p>我们来看一下 manage.py 的代码：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;ProjectName.settings&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># The above import may fail for some other reason. Ensure that the</span>
        <span class="c1"># issue is really that Django is missing to avoid masking other</span>
        <span class="c1"># exceptions on Python 2.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">django</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Couldn&#39;t import Django. Are you sure it&#39;s installed and &quot;</span>
                <span class="s2">&quot;available on your PYTHONPATH environment variable? Did you &quot;</span>
                <span class="s2">&quot;forget to activate a virtual environment?&quot;</span>
            <span class="p">)</span>
        <span class="k">raise</span>
    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>manage.py 的代码内容很好理解，就是为了执行与 <code>django-admin</code> 命令，
不同的是它预先配置了一个名为 <code>DJANGO_SETTINGS_MODULE</code> 的环境变量。</p>
<p>django-admin 的子命令有一些需要这个变量，有一些不需要。对于不需要这个变量的命令，
比如 <code>startapp</code> 或 <code>help</code>，执行：</p>
<div class="codehilite"><pre><span></span>django-admin startapp myapp
</pre></div>


<p>与执行：</p>
<div class="codehilite"><pre><span></span>python manage.py startapp myapp
</pre></div>


<p>或：</p>
<div class="codehilite"><pre><span></span>./manage.py startapp myapp
</pre></div>


<p>效果是完全一样的。</p>
<p>而其余的大部分 <code>django-admin</code> 子命令都需要 <code>DJANGO_SETTINGS_MODULE</code> 环境变量，
这时候必须以 <code>./manage.py</code> 开头，而不能够以 <code>django-admin</code> 开头。比如 <code>runserver</code>,
你就必须在项目目录下执行 </p>
<div class="codehilite"><pre><span></span>python manage.py runserver
</pre></div>


<p>或 </p>
<div class="codehilite"><pre><span></span>./manage.py runserver
</pre></div>


<p>而如果执行：</p>
<div class="codehilite"><pre><span></span>django-admin runserver
</pre></div>


<p>是会报错的。</p>
<p>为了方便，我们建议除了在生成项目执行 <code>startproject</code> 命令时使用 <code>django-admin</code>，
其余任何命令都使用 <code>./manage.py</code>。</p>
            </div>
        </div>
        <div class="col-md-3" role="complementary">
            <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix">
                <h3>目录</h3>
                <ul class="nav bs-docs-sidenav">
                    
                </ul>              
            </nav>
        </div>
    </div>
</body>

</html>