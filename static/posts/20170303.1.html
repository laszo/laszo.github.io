<html>
<head>
    <meta charset="utf-8">
    <title>-- 未完 - Python标准库和wsgiref库提供的Server和Handler分析 - Lv Xiaoyu `Site</title>
    <link rel="stylesheet" href="../../static/css/mp.css?v=1" />
    <link rel="stylesheet" href="../../static/css/bootstrap.min.css?v=1" />
</head>
<body>
    <div class="container">
        <div class="blog-header">
            <a href="../../index.html"><h1>Lv Xiaoyu `Site</h1></a>
        </div>

        <h3 class="blog-post-title">-- 未完 - Python标准库和wsgiref库提供的Server和Handler分析</h3>

        <div class="post-content">
            <p>HTTPServer、BaseHTTPRequestHandler、SimpleHTTPServer、
CGIHTTPServer，</p>
<p>serve_forever由来自Python标准库里的SocketServer所定义
（/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/SocketServer.py）：</p>
<pre><code>class BaseServer:
    def serve_forever(self, poll_interval=0.5):
        try:
            while not self.__shutdown_request:
                if self in r:
                    self._handle_request_noblock()
        finally:
            self.__shutdown_request = False
            self.__is_shut_down.set()

    def _handle_request_noblock(self):
        try:
            request, client_address = self.get_request()
        except socket.error:
            return
        if self.verify_request(request, client_address):
            try:
                self.process_request(request, client_address)
            except:
                self.handle_error(request, client_address)
                self.shutdown_request(request)

    def process_request(self, request, client_address):
        self.finish_request(request, client_address)
        self.shutdown_request(request)

    def finish_request(self, request, client_address):
        self.RequestHandlerClass(request, client_address, self)
</code></pre>
<p>可以看到，所谓的Server，它的核心工作就是一个无限的循环，在没有接到关闭的请求之前，
它每次接收一个请求，传递给预先定义的处理类RequestHandlerClass进行处理。</p>
        </div>
    </div>
</body>
</html>