<html>
<head>
    <meta charset="utf-8">
    <title>WSGI初探 - Lv Xiaoyu `Site</title>
    <link rel="stylesheet" href="../../static/css/bootstrap.min.css?v=1" />
    <link rel="stylesheet" href="../../static/css/mp.css?v=1" />
    <link rel="stylesheet" href="../../static/css/codehilite.css?v=1" />
</head>
<body>
    <div class="container">
        <div class="blog-header">
            <a href="../../index.html"><h1>Lv Xiaoyu `Site</h1></a>
        </div>

        <h3 class="blog-post-title">WSGI初探</h3>

        <div class="post-content">
            <p>最简单的WSGI Application代码，没有用到FrameWork，</p>
<div class="codehilite"><pre><span></span># test.py
def app(env, start_response):
    start_response(&#39;200 OK&#39;, [(&#39;Content-type&#39;, &#39;text/plain&#39;)])
    return [&#39;hello, world&#39;]
</pre></div>


<p>使用<code>gunicorn</code>可以运行：</p>
<div class="codehilite"><pre><span></span>gunicorn test:app
</pre></div>


<p>可以看到运行的输出：</p>
<div class="codehilite"><pre><span></span>[2017-05-08 11:41:58 +0800] [1133] [INFO] Starting gunicorn 19.7.0
[2017-05-08 11:41:58 +0800] [1133] [INFO] Listening at: http://127.0.0.1:8000 (1133)
[2017-05-08 11:41:58 +0800] [1133] [INFO] Using worker: sync
[2017-05-08 11:41:58 +0800] [1136] [INFO] Booting worker with pid: 1136
</pre></div>


<p>或者使用Python标准库自带的wsgiref库：</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>

<span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">]</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
        </div>
    </div>
</body>
</html>